<!DOCTYPE html>
<html>
    <head>
        <title>Input In Container Fixed To Top Of Viewport | datetimepicker Tests</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link rel="stylesheet" type="text/css" href="jquery.datetimepicker.css"/>


		<style>		
			.noselect {
			  -webkit-touch-callout: none; /* iOS Safari */
				-webkit-user-select: none; /* Safari */
				 -khtml-user-select: none; /* Konqueror HTML */
				   -moz-user-select: none; /* Firefox */
					-ms-user-select: none; /* Internet Explorer/Edge */
						user-select: none; /* Non-prefixed version, currently supported by Chrome and Opera */
			}

			#dtp_calendar {
				display:inline-block;
			}

			#dtp_calendar td {
				border: 1px solid #ddd;
				text-align: center;

				-webkit-touch-callout: none; /* iOS Safari */
				-webkit-user-select: none; /* Safari */
				 -khtml-user-select: none; /* Konqueror HTML */
				   -moz-user-select: none; /* Firefox */
					-ms-user-select: none; /* Internet Explorer/Edge */
						user-select: none; /* Non-prefixed version, currently supported by Chrome and Opera */
			}
			
			#dtp_header {
				display: flex;                  /* establish flex container */
				flex-direction: row;            /* default value; can be omitted */
				flex-wrap: nowrap;              /* default value; can be omitted */
				justify-content: space-between; /* switched from default (flex-start, see below) */

				background-color: #F8F8FF ;
			}
			
			.table_cell  {
				padding: 0px;
				
				width: 35px;
				height: 35px;
			}
			
			.table_cell > div {
				/* part 1 of 2: helps put child tag in the center */
				/* change width and height to any percentage */
				
				display: table;
				width: 100%;
				height: 100%;
				text-align: center;
				
				margin: auto;
			}
			
			.table_cell > div > span {
				/* part 2 of 2: helps put child tag in the center */
				display: table-cell;
				vertical-align: middle;
			}
			
			
			.selected_cell {
				background-color: lightblue;
				// background color of the table cell
				-webkit-box-shadow: inset 0 0 3px 3px dodgerblue;
						box-shadow: inset 0 0 3px 3px dodgerblue;
						
				margin: -2px;
			}
		</style>
    </head>

    <body>
		<div id="dtp_calendar"></div>

        <script>
			// creates an n-dimensional array createArray(length...)
			function createArray(length) {
				var arr = new Array(length || 0);
				var i = length;

				for (var i = 0; i < length; i++) {
					arr[i] = 0;
				}

				if (arguments.length > 1) {
					var args = Array.prototype.slice.call(arguments, 1);
					while (i--) {
						arr[length-1 - i] = createArray.apply(this, args);
					}
				}

				return arr;
			}
		
			// check how many days in a month code from https://dzone.com/articles/determining-number-days-month
			function daysInMonth(iMonth, iYear) {
				return 32 - new Date(iYear, iMonth, 32).getDate();
			}
		
			// get week number adapted from https://stackoverflow.com/questions/7765767/show-week-number-with-javascript
			function getWeek (date) {
				var onejan = new Date(date.getFullYear(), 0, 4);
				return Math.ceil((((date - onejan) / 86400000) + onejan.getDay() + 1) / 7);
			}
		
			function getDaysOfTheWeek () {
				return [
					"Sun",
					"Mon",
					"Tue",
					"Wed",
					"Thu",
					"Fri",
					"Sat"
				];
			}

			function buildCalendarArray (month, year) {				
				// prepare some metadata about the given month and year
				var d = new Date(year, month);
			    let firstDay = d.getDay();
			    let firstWeek = getWeek(d);

				var dayCounter = 1;
				var numDaysInMonth = daysInMonth(month, year);
				
				// loop over each element in the table array
				for (var rowIdx = 0; rowIdx < numRows; rowIdx++) {
					tableArray[rowIdx][0] = firstWeek + rowIdx;
					
					for (var colIdx = 1; colIdx < numCols; colIdx++) {
						if (rowIdx === 0 && colIdx <= firstDay) {
							// if cell is before the current month ?? intuitively < makes sense not <=
							tableArray[rowIdx][colIdx] = "";
						} else if (dayCounter > numDaysInMonth) {
							// if cell is after the current month
							tableArray[rowIdx][colIdx] = "";
						} else {
							tableArray[rowIdx][colIdx] = new Date(year, month, dayCounter);
							dayCounter++;
						}
					}
				}

				return {
					data: tableArray,
					rows: numRows,
					cols: numCols
				};
			}

			function buildTableCell (innerHTML, id) {
				var tableCell = document.createElement("td");
				tableCell.className = "table_cell";
				
				if (id !== "") {
					tableCell.id = id;
				}
				
				tableCell.innerHTML = innerHTML;

				return tableCell;
			}

			function buildCalendarTableHead () {
				var headRow = document.createElement("tr");
				
				headRow.appendChild(document.createElement("td")); // empty placeholder for week number

				// build td for each day
				getDaysOfTheWeek().forEach ((item, index) => {
					var dotwCell = buildTableCell(item, "");
					
					dotwCell.dataset.row = -1;
					dotwCell.dataset.col = index;
					dotwCell.onclick = function () {
						onCellClick([this.dataset.row, this.dataset.col], false, true);
					};

					headRow.appendChild(dotwCell);
				});

				// build the top level parent
				var headRoot = document.createElement("thead");
				headRoot.appendChild(headRow);
				
				return headRoot;
			}
			
			function buildCalendarTableBody (tableData) {
				var tableBody = document.createElement("tbody");
				
				for (var rowIdx = 0; rowIdx < tableData.rows; rowIdx++) {
					var tableRow = document.createElement("tr");
					tableRow.id = "week-" + rowIdx;
					
					// week idx
					var weekIdxCell = buildTableCell(tableData.data[rowIdx][0], "week-" + rowIdx);
					weekIdxCell.dataset.row = rowIdx;
					weekIdxCell.dataset.col = -1;
					
					weekIdxCell.onclick = function () {
						onCellClick([this.dataset.row, this.dataset.col], true, false);
					};

					tableRow.appendChild(weekIdxCell);	
					
					for (var colIdx = 1; colIdx < tableData.cols; colIdx++) {
						if (tableData.data[rowIdx][colIdx] === "") {
							tableRow.appendChild(buildTableCell("", ""));	
						} else {  
							var day = new Date(tableData.data[rowIdx][colIdx]);
							var dayCell = buildTableCell(day.getDate(), "");
							
							dayCell.classList.add("day_cell");
							
							dayCell.dataset.row = rowIdx;
							dayCell.dataset.col = colIdx-1;
							
							dayCell.dataset.day = day.getDate();
							dayCell.dataset.month = day.getMonth()+1;
							dayCell.dataset.year = day.getFullYear();
							
							dayCell.onclick = function () {
								onCellClick([this.dataset.row, this.dataset.col], false, false);
							};
							
							tableRow.appendChild(dayCell);	
						}
					}

					// after constructing the row, append it to the body
					tableBody.appendChild(tableRow);
				}

				return tableBody;
			}

			function buildCalendarHeader (month, year) {
				var months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
				
				var leftArrow = document.createElement("button");
				leftArrow.id = "leftArrowSelector";
				leftArrow.innerHTML = "<";
				leftArrow.onclick = function () {
					curMonth -= 1;
					
					if (curMonth < 1) {
						curMonth = 12;
						curYear -= 1;
					}
					
					showCalendar(curMonth, curYear);
				};
				
				var rightArrow = document.createElement("button");
				rightArrow.id = "rightArrowSelector";
				rightArrow.innerHTML = ">";
				rightArrow.onclick = function () {
					curMonth += 1;
					
					if (curMonth > 12) {
						curMonth = 1;
						curYear += 1;
					}
					
					showCalendar(curMonth, curYear);
				};
				
				var title = document.createElement("span");
				title.innerHTML = months[month] + "&emsp;" + year;
				
				var headerParent = document.createElement("div");
				headerParent.id = "dtp_header";
				
				headerParent.appendChild(leftArrow);
				headerParent.appendChild(title);
				headerParent.appendChild(rightArrow);
				
				return headerParent;
			}

			function showCalendar (month, year) {
				// month [1, 12] year (eg. 2019)
				var calendarDiv = document.getElementById("dtp_calendar");
				calendarDiv.innerHTML = "";

				var tableData = buildCalendarArray(month-1, year);

				// --------------------------------------------------------
				var parent = document.createElement("div");

				parent.appendChild(buildCalendarHeader(month-1, year));
				
				var tableParent = document.createElement("table");
				tableParent.appendChild(buildCalendarTableHead());
				tableParent.appendChild(buildCalendarTableBody(tableData));
				parent.appendChild(tableParent);
				
				calendarDiv.appendChild(parent);
				// --------------------------------------------------------
				
				return tableData;
			}
						
			function toggleCell (rowIdx, colIdx) {
				var rowQuery = "[data-row='" + rowIdx + "']";
				var colQuery = "[data-col='" + colIdx + "']";
				var classQuery = ".day_cell";

				var cell = document.querySelectorAll(classQuery + rowQuery + colQuery)[0];

				if (cell.classList.toString().includes("selected_cell")) {
					cell.classList.remove("selected_cell");
					selectedArray[rowIdx][colIdx] = 0;
				} else {
					cell.classList.add("selected_cell");
					selectedArray[rowIdx][colIdx]++;
				}
				
				return [cell];
			}
			
			function toggleCol (colIdx) {
				var colQuery = "[data-col='" + colIdx + "']";
				var classQuery = ".day_cell";

				var cells = document.querySelectorAll(classQuery + colQuery);
				
				for (var cellIdx = 0; cellIdx < cells.length; cellIdx++) {
					var cellRow = cells[cellIdx].dataset.row;
					
					if (cells[cellIdx].classList.toString().includes("selected_cell")) {
						if (selectedArray[cellRow][colIdx] == 0) {
							cells[cellIdx].classList.remove("selected_cell");
						} else {
							selectedArray[cellRow][colIdx]--;
						}
					} else {
						cells[cellIdx].classList.add("selected_cell");
						selectedArray[cellRow][colIdx]++;
					}
				}

				return cells;
			}
			
			function toggleRow (rowIdx) {
				var rowQuery = "[data-row='" + rowIdx + "']";
				var classQuery = ".day_cell";

				var cells = document.querySelectorAll(classQuery + rowQuery);

				for (var cellIdx = 0; cellIdx < cells.length; cellIdx++) {
					var cellCol = cells[cellIdx].dataset.col;

					if (cells[cellIdx].classList.toString().includes("selected_cell")) {					
						if (selectedArray[rowIdx][cellCol] == 0) {
							cells[cellIdx].classList.remove("selected_cell");
						} else {
							selectedArray[rowIdx][cellCol]--;
						}						
					} else {
						cells[cellIdx].classList.add("selected_cell");
						selectedArray[rowIdx][cellCol]++;
					}
				}

				return cells;
			}
			
			// 5 rows, 8 columns (1 for week num, 7 for dotw)
			var numRows = 5; 
			var numCols = 8;
			
			// selectedArray maintains a count of the # times a cell is toggled
			var selectedArray = createArray(numRows, numCols-1); // dont need to worry about weeknum col
			// tableArray maintains the table data
			var tableArray = createArray(numRows, numCols);

			var curMonth = 10;
			var curYear = 2019;

			showCalendar(curMonth, curYear);
        </script>

		<script>
			function onCellClick (cellIdx, isWeekSelectionToggle, isDaySelectionToggle) {
				var changedCells = [];
			
				if (isWeekSelectionToggle) {
					changedCells = toggleRow(cellIdx[0]);
				} else if (isDaySelectionToggle) {
					changedCells = toggleCol(cellIdx[1]);
				} else {
					changedCells = toggleCell(cellIdx[0], cellIdx[1]);
				}
				
				//console.log(changedCells);
			}
		</script>
    </body>
</html>
