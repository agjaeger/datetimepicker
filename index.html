<!DOCTYPE html>
<html>
    <head>
        <title>Input In Container Fixed To Top Of Viewport | datetimepicker Tests</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link rel="stylesheet" type="text/css" href="jquery.datetimepicker.css"/>


		<style>
			.noselect {
			  -webkit-touch-callout: none; /* iOS Safari */
				-webkit-user-select: none; /* Safari */
				 -khtml-user-select: none; /* Konqueror HTML */
				   -moz-user-select: none; /* Firefox */
					-ms-user-select: none; /* Internet Explorer/Edge */
						user-select: none; /* Non-prefixed version, currently supported by Chrome and Opera */
			}

			#dtp_calendar td {
				border: 1px solid #ddd;
				text-align: center;
				

				
				-webkit-touch-callout: none; /* iOS Safari */
				-webkit-user-select: none; /* Safari */
				 -khtml-user-select: none; /* Konqueror HTML */
				   -moz-user-select: none; /* Firefox */
					-ms-user-select: none; /* Internet Explorer/Edge */
						user-select: none; /* Non-prefixed version, currently supported by Chrome and Opera */
			};
						
			#dtp_calendar > tbody > td > div {
				
			}
			
			.tablecell  {
				padding: 0px;
				
				width: 35px;
				height: 35px;
			}
			
			.tablecell > div {
				/* part 1 of 2: helps put child tag in the center */
				/* change width and height to any percentage */
				
				display: table;
				width: 100%;
				height: 100%;
				text-align: center;
				
				margin: auto;
			}
			
			.tablecell > div > span {
				/* part 2 of 2: helps put child tag in the center */
				display: table-cell;
				vertical-align: middle;
			}
			
			
			.selected_cell {
				background-color: lightblue;
				// background color of the table cell
				-webkit-box-shadow: inset 0 0 3px 3px dodgerblue;
						box-shadow: inset 0 0 3px 3px dodgerblue;
						
				margin: -2px;
			}
		</style>
    </head>

    <body>
		<div id="dtp_calendar"></div>

        <script>
			// creates an n-dimensional array createArray(length...)
			function createArray(length) {
				var arr = new Array(length || 0),
					i = length;

				if (arguments.length > 1) {
					var args = Array.prototype.slice.call(arguments, 1);
					while(i--) arr[length-1 - i] = createArray.apply(this, args);
				}

				return arr;
			}
		
			// check how many days in a month code from https://dzone.com/articles/determining-number-days-month
			function daysInMonth(iMonth, iYear) {
				return 32 - new Date(iYear, iMonth, 32).getDate();
			}
		
			// get week number adapted from https://stackoverflow.com/questions/7765767/show-week-number-with-javascript
			function getWeek (date) {
				var onejan = new Date(date.getFullYear(), 0, 4);
				return Math.ceil((((date - onejan) / 86400000) + onejan.getDay() + 1) / 7);
			}
		
			function getDaysOfTheWeek () {
				return [
					"Sun",
					"Mon",
					"Tue",
					"Wed",
					"Thu",
					"Fri",
					"Sat"
				];
			}

			function buildCalendarArray (month, year) {
				// 5 rows, 8 columns (1 for week num, 7 for dotw)
				var numRows = 5; 
				var numCols = 8;
				
				var tableArray = createArray(numRows, numCols);
				
				// prepare some metadata about the given month and year
				var d = new Date(year, month);
			    let firstDay = d.getDay();
			    let firstWeek = getWeek(d);

				var dayCounter = 1;
				var numDaysInMonth = daysInMonth(month, year);
				
				// loop over each element in the table array
				for (var rowIdx = 0; rowIdx < numRows; rowIdx++) {
					tableArray[rowIdx][0] = firstWeek + rowIdx;
					
					for (var colIdx = 1; colIdx < numCols; colIdx++) {
						if (rowIdx === 0 && colIdx <= firstDay) {
							// if cell is before the current month ?? intuitively < makes sense not <=
							tableArray[rowIdx][colIdx] = "";
						} else if (dayCounter > numDaysInMonth) {
							// if cell is after the current month
							tableArray[rowIdx][colIdx] = "";
						} else {
							tableArray[rowIdx][colIdx] = new Date(year, month, dayCounter);
							dayCounter++;
						}
					}
				}

				return {
					data: tableArray,
					rows: numRows,
					cols: numCols
				};
			}

			function buildTableCell (innerHTML, id) {
				var tableCell = document.createElement("td");
				tableCell.className = "tablecell";
				
				if (id !== "") {
					tableCell.id = id;
				}
				
				tableCell.innerHTML = innerHTML;

				return tableCell;
			}

			function buildCalendarTableHead () {
				var headRow = document.createElement("tr");
				
				headRow.appendChild(document.createElement("td")); // empty placeholder for week number

				// build td for each day
				getDaysOfTheWeek().forEach ((item, index) => {
					headRow.appendChild(buildTableCell(item, ""));
				});

				// build the top level parent
				var headRoot = document.createElement("thead");
				headRoot.appendChild(headRow);
				
				return headRoot;
			}
			
			function buildCalendarTableBody (tableData) {
				var tableBody = document.createElement("tbody");
				
				for (var rowIdx = 0; rowIdx < tableData.rows; rowIdx++) {
					var tableRow = document.createElement("tr");
					tableRow.id = "week-" + rowIdx;
					
					// week idx
					var weekIdxCell = buildTableCell(tableData.data[rowIdx][0], "week-" + rowIdx);
					weekIdxCell.dataset.row = rowIdx;
					weekIdxCell.dataset.col = 0;
					
					weekIdxCell.onclick = function () {
						onCellClick([this.dataset.row, this.dataset.col], true, false);
					};

					tableRow.appendChild(weekIdxCell);	
					
					for (var colIdx = 1; colIdx < tableData.cols; colIdx++) {
						if (tableData.data[rowIdx][colIdx] === "") {
							tableRow.appendChild(buildTableCell("", ""));	
						} else {  
							var dayLabel = new Date(tableData.data[rowIdx][colIdx]).getDate();
							var dayCell = buildTableCell(dayLabel, "");
							
							dayCell.className += " day_cell " + ("dotw-" + (colIdx-1));
							
							dayCell.dataset.row = rowIdx;
							dayCell.dataset.col = colIdx-1;
							
							dayCell.onclick = function () {
								onCellClick([this.dataset.row, this.dataset.col], false, false);
							};
							
							tableRow.appendChild(dayCell);	
						}
					}

					// after constructing the row, append it to the body
					tableBody.appendChild(tableRow);
				}
				
				// Build the last row which contains checkboxes for day selection
				var checkboxRow = document.createElement("tr");
				checkboxRow.appendChild(buildTableCell("", "")); // append placeholder for week number
				
				for (var dIdx = 0; dIdx < 7; dIdx++) {
					var daySelectionToggleCell = buildTableCell("", "dotw-"+dIdx);
					daySelectionToggleCell.dataset.row = 0;
					daySelectionToggleCell.dataset.col = dIdx;
					daySelectionToggleCell.onclick = function () {
						onCellClick([this.dataset.row, this.dataset.col], false, true);
					};
					
					checkboxRow.appendChild(daySelectionToggleCell);
				}
				
				tableBody.appendChild(checkboxRow);

				return tableBody;
			}

			function showCalendar (month, year) {
				// month [1, 12] year (eg. 2019)
				var calendarDiv = document.getElementById("dtp_calendar");
				calendarDiv.innerHTML = "";
				
				var tableData = buildCalendarArray(month-1, year);

				calendarDiv.appendChild(buildCalendarTableHead());
				calendarDiv.appendChild(buildCalendarTableBody(tableData));
				
				return tableData;
			}
			
			function toggleCell (rowIdx, colIdx) {
				var rowElement = document.getElementById("week-" + rowIdx);
				var colElements = rowElement.getElementsByClassName("dotw-" + colIdx);
				
				console.log(colElements);
			}
			
			function toggleCol (colIdx) {
				var colElements = document.getElementsByClassName("dotw-" + colIdx);
				
				for (var colIdx = 0; colIdx < colElements.length; colIdx++) {
					if (colElements[colIdx].classList.toString().includes("selected_cell")) {
						colElements[colIdx].classList.remove("selected_cell");
					} else {
						colElements[colIdx].classList.add("selected_cell");
					}
				}
			}
			
			function toggleRow (rowIdx) {
				var rowElement = document.getElementById("week-" + rowIdx);
				var dayElements = rowElement.getElementsByClassName("day_cell");
				
				for (var dayIdx = 0; dayIdx < dayElements.length; dayIdx++) {
					if (dayElements[dayIdx].classList.toString().includes("selected_cell")) {
						dayElements[dayIdx].classList.remove("selected_cell");
					} else {
						dayElements[dayIdx].classList.add("selected_cell");
					}
				}
			}
			
			function sleep (time) {
				return new Promise((resolve) => setTimeout(resolve, time));
			}
			
			showCalendar(10, 2019);
			
			<!-- sleep(5000).then(() => { -->
				<!-- showCalendar(11, 2019); -->
			<!-- }); -->
			
			<!-- sleep(10000).then(() => { -->
				<!-- showCalendar(12, 2019); -->
			<!-- }); -->
        </script>

		<script>
			function onCellClick (cellIdx, isWeekSelectionToggle, isDaySelectionToggle) {
				if (isWeekSelectionToggle) {
					toggleRow(cellIdx[0]);
				}

				else if (isDaySelectionToggle) {
					toggleCol(cellIdx[1]);
				}
				
				else {
					toggleCell(cellIdx[0], cellIdx[1]);
				}
			}
		</script>
    </body>
</html>
